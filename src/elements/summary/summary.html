<template>
  <require from="resources/elements/card-properties-list"></require>
  <require from="./cards/action-card.html"></require>
  <require from="./cards/artifact-card.html"></require>
  <require from="./cards/creature-card.html"></require>
  <require from="./cards/upgrade-card.html"></require>
  <require from="./summary.scss"></require>

  <div id="summary-parameters">
    <div class="form-group row">
      <!-- TODO BUG Le tri / groupage par compétence devrait créer des groupes par lettre, que ça soit les skills ou les triggers -->
      <label for="groupByInput" class="col-sm-1 col-form-label">${i18nService.get('ui.summary.parameters.group-by')}</label>
      <div class="col-sm-5">
        <select id="groupByInput" value.bind="groupingProperty">
          <option value="undefined"></option>
          <option repeat.for="property of CardPropertiesEnum" model.bind="getCardPropertyValue(property)">${i18nService.get(`ui.summary.cardProperties.${property.toLowerCase()}`)}</option>
        </select>
      </div>
      <label for="sortByInput" class="col-sm-1 col-form-label">${i18nService.get('ui.summary.parameters.sort-by')}</label>
      <div class="col-sm-5">
        <select id="sortByInput" value.bind="sortingProperty">
          <option value="undefined"></option>
          <option repeat.for="property of CardPropertiesEnum" model.bind="getCardPropertyValue(property)">${i18nService.get(`ui.summary.cardProperties.${property.toLowerCase()}`)}</option>
        </select>
      </div>
    </div>

    <div class="form-group row"></div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="inlineCheckbox1" checked.bind="showHouses">
        <label class="form-check-label" for="inlineCheckbox1">${i18nService.get('ui.summary.parameters.show-card-houses')}</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="inlineCheckbox2" checked.bind="showDeckHouses">
        <label class="form-check-label" for="inlineCheckbox2">${i18nService.get('ui.summary.parameters.show-deck-houses')}</label>
      </div>
    </div>
    
    <!-- TODO Add image size parameters -->
    <!-- TODO Add QR code size parameters -->
    <!-- TODO Add parameter to show/hide the "Action" trigger on an artifact if it is the only trigger -->

    <!-- TODO Remplacer par une select box multiple qui permet de choisir ce qu'on affiche ou pas : maisons dans les cartes, cercle des 3 maisons du deck, qr code, skills, triggers, puissance, armure... -->
    <!--input type="checkbox" checked.bind="showHouses">${i18nService.get('ui.summary.parameters.show-houses')}</input-->

    <button click.delegate="rebuild()">${i18nService.get('ui.summary.refresh')}</button>
    <button click.delegate="download()">${i18nService.get('ui.summary.download')}</button>
  </div>

  <!-- TODO Add a name tag with the name of the archon and the 3 houses of the deck -->

  <div id="summary-cards" class="summary-sheet">
    <div class="archon-image" css="background-image: url(${currentDeckService.deck.backgroundImage});"></div>
    <div class="float-left container columns">
      <!-- TODO BUG Classer par armure puis puissance (par ex) : le premier groupe (pour sans armure) conserve son libellé au lieu de devenir "sans puissance" -->
      <div repeat.for="group of groups">
        <!-- TODO BUG Si 10 actions et 10 artefacts, alors le titre "Creatures" apparaît en haut de la 2è colonne mais sous la première carte créature ! 
        En gros ce bug apparaît si le titre "Creatures" devrait être affiché tout en bas de la 1ère colonne mais qu'il n'y a pas passez de place"
        Fait intéressant : ce glitch d'affichage se produit aussi sur une carte normale, et il n'apparaît pas lorsqu'on DL l'image -->
        <div class="group-entry">
          <div class="col">
            <span class='group-title'>${getGroupTitle(group)} <span class="group-count">${cardsByGroup[group].length}</span></span>
          </div>
        </div>
        <compose containerless repeat.for="card of cardsByGroup[group]" view-model="./cards/summary-card" view="./cards/${card.type}-card.html" model.bind="card"></compose>
      </div>
    </div>

    <img src.bind="qrcode" class="qrcode-image" >

    <div class="deck-houses" show.bind="showDeckHouses">
      <ul class="circle-container">
        <li>
          <div class="house-${house1}">
            <img src.bind="'images/houses/' + house1 + '.png'">
          </div>
        </li>
        <li>
          <div class="house-${house2}">
            <img src.bind="'images/houses/' + house2 + '.png'">
          </div>
        </li>
        <li>
          <div class="house-${house3}">
            <img src.bind="'images/houses/' + house3 + '.png'">
          </div>
        </li>
      </ul>
    </div>
  </div>
</template>
