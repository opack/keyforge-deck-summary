<template>
  <require from="@fortawesome/fontawesome-free/css/all.css"></require>
  <require from="resources/elements/card-properties-list"></require>
  <require from="./cards/action-card.html"></require>
  <require from="./cards/artifact-card.html"></require>
  <require from="./cards/creature-card.html"></require>
  <require from="./cards/upgrade-card.html"></require>
  <require from="./summary.scss"></require>

  <div id="summary-parameters d-flex">
    <div class="p-1 btn-group" role="group">
      <!-- TODO BUG Le tri / groupage par compétence devrait créer des groupes par lettre, que ça soit les skills ou les triggers -->
      <!-- Group by menu -->
      <div class="btn-group" role="group">
        <button class="btn-secondary dropdown-toggle" data-toggle="dropdown">
            ${i18nService.get('ui.summary.parameters.group-by')} ${i18nService.get(`ui.summary.cardProperties.${groupingProperty}`)}
        </button>
        <div class="dropdown-menu">
          <button repeat.for="property of CardPropertiesEnum" class="dropdown-item btn-info ${groupingProperty===property.toLowerCase()? 'active': ''}" data-toggle="button" aria-pressed="false" autocomplete="off" click.delegate="selectGroupByProperty(property.toLowerCase())">
            ${i18nService.get(`ui.summary.cardProperties.${property.toLowerCase()}`)}
          </button>
        </div>
      </div>

      <!-- Sort by menu -->
      <div class="btn-group" role="group">
        <button class="btn-secondary dropdown-toggle" data-toggle="dropdown">
            ${i18nService.get('ui.summary.parameters.sort-by')} ${i18nService.get(`ui.summary.cardProperties.${sortingProperty}`)}
        </button>
        <div class="dropdown-menu">
          <button repeat.for="property of CardPropertiesEnum" class="dropdown-item btn-info ${sortingProperty===property.toLowerCase()? 'active': ''}" data-toggle="button" aria-pressed="false" autocomplete="off" click.delegate="selectSortByProperty(property.toLowerCase())">
            ${i18nService.get(`ui.summary.cardProperties.${property.toLowerCase()}`)}
          </button>
        </div>
      </div>

      <!-- Show houses menu -->
      <div class="btn-group" role="group">
        <button class="btn-secondary dropdown-toggle" data-toggle="dropdown">
            ${i18nService.get('ui.summary.parameters.show-houses')}
        </button>
        <div class="dropdown-menu">
          <button class="dropdown-item btn-info ${showHouses? 'active': ''}" data-toggle="button" aria-pressed="false" autocomplete="off" click.delegate="toggleShowCardHouses()">
            ${i18nService.get('ui.summary.parameters.show-houses-on-cards')}
          </button>
          <button class="dropdown-item btn-info ${showDeckHouses? 'active': ''}" data-toggle="button" aria-pressed="false" autocomplete="off" click.delegate="toggleShowDeckHouses()">
            ${i18nService.get('ui.summary.parameters.show-houses-on-deck')}
          </button>
        </div>
      </div>

      <!-- Show creature data menu -->
      <div class="btn-group" role="group">
        <button class="btn-secondary dropdown-toggle" data-toggle="dropdown">
            ${i18nService.get('ui.summary.parameters.show-creatures-data')}
        </button>
        <div class="dropdown-menu">
          <button class="dropdown-item btn-info ${showCreaturesPower? 'active': ''}" data-toggle="button" aria-pressed="false" autocomplete="off" click.delegate="toggleShowCreaturesPower()">
            <img src.bind="'images/misc/power.png'" class="summary-parameter-image"> ${i18nService.get('ui.summary.parameters.show-creatures-power')}
          </button>
          <button class="dropdown-item btn-info ${showCreaturesArmor? 'active': ''}" data-toggle="button" aria-pressed="false" autocomplete="off" click.delegate="toggleShowCreaturesArmor()">
            <img src.bind="'images/misc/shield.png'" class="summary-parameter-image"> ${i18nService.get('ui.summary.parameters.show-creatures-armor')}
          </button>
          <button class="dropdown-item btn-info ${showCreaturesSkills? 'active': ''}" data-toggle="button" aria-pressed="false" autocomplete="off" click.delegate="toggleShowCreaturesSkills()">
            <img src.bind="'images/misc/skills.png'" class="summary-parameter-image"> ${i18nService.get('ui.summary.parameters.show-creatures-skills')}
          </button>
        </div>
      </div>
    </div>

    <!-- TODO Add an option to show/hide the group counts -->
    <!-- TODO Add image size parameters -->
    <!-- TODO Add QR code size parameters and display option -->
    <!-- TODO Add parameter to show/hide the "Action" trigger on an artifact if it is the only trigger -->

    <!-- TODO Remplacer par une select box multiple qui permet de choisir ce qu'on affiche ou pas : maisons dans les cartes, cercle des 3 maisons du deck, qr code, skills, triggers, puissance, armure... -->
    <!--input type="checkbox" checked.bind="showHouses">${i18nService.get('ui.summary.parameters.show-houses')}</input-->

    <div class="p-1 btn-group" role="group">
      <button click.delegate="rebuild()">
        <i class="fas fa-sync"></i>
      </button>
      <button click.delegate="download()">
        <i class="fas fa-download"></i>
      </button>
    </div>
  </div>
  <!-- TODO Add a name tag with the name of the archon and the 3 houses of the deck -->

  <div id="summary-cards" class="summary-sheet">
    <div class="archon-image" css="background-image: url(${currentDeckService.deck.backgroundImage});"></div>
    <div class="float-left container columns">
      <!-- TODO BUG Classer par armure puis puissance (par ex) : le premier groupe (pour sans armure) conserve son libellé au lieu de devenir "sans puissance" -->
      <div repeat.for="group of groups">
        <!-- TODO BUG Si 10 actions et 10 artefacts, alors le titre "Creatures" apparaît en haut de la 2è colonne mais sous la première carte créature ! 
        En gros ce bug apparaît si le titre "Creatures" devrait être affiché tout en bas de la 1ère colonne mais qu'il n'y a pas passez de place"
        Fait intéressant : ce glitch d'affichage se produit aussi sur une carte normale, et il n'apparaît pas lorsqu'on DL l'image -->
        <div class="group-entry">
          <div class="col">
            <span class='group-title'>${getGroupTitle(group)} <span class="group-count">${cardsByGroup[group].length}</span></span>
          </div>
        </div>
        <compose containerless repeat.for="card of cardsByGroup[group]" view-model="./cards/summary-card" view="./cards/${card.type}-card.html" model.bind="card"></compose>
      </div>
    </div>

    <div class="general-data">
      <img src.bind="qrcode" class="p-2 qrcode-image" if.bind="!isNullOrUndefined(qrcode) && qrcode !== ''">

      <div class="p-2 deck-houses" show.bind="showDeckHouses">
        <ul class="circle-container">
          <li>
            <div class="house-${house1}">
              <img src.bind="'images/houses/' + house1 + '.png'">
            </div>
          </li>
          <li>
            <div class="house-${house2}">
              <img src.bind="'images/houses/' + house2 + '.png'">
            </div>
          </li>
          <li>
            <div class="house-${house3}">
              <img src.bind="'images/houses/' + house3 + '.png'">
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</template>
